#pyfort-Lefevre-RoyNoughier-C
#JeanChipo & WarrenOne
#Ce fichier pr√©sente l'impl√©mentation des fonctions utiles qui g√®rent les joueurs, les √©preuves, et l'enregistrement des r√©sultats du jeu

def bold(text:str)->str:
    return "\033[1m" + text + "\033[0m"

def introduction()->None:
    """Affiche le script d'introduction de fort boyard."""
    print(
        bold("üéôÔ∏è Denis brognard :") +'\n'
        "Salut tout le monde, et bienvenue dans l‚Äôincroyable aventure de Fort Boyard ! \n"
        "Aujourd‚Äôhui, nos candidats vont devoir se d√©passer pour relever des d√©fis et, surtout, \n"
        "d√©crocher leur ticket pour la fameuse Salle du Tr√©sor. \n"
        "Rien ne sera facile, mais avec un peu de courage et de strat√©gie, tout est possible. \n"
        '\n' +
        bold("üí° Les r√®gles, c‚Äôest simple :") +'\n'
        "Votre √©quipe doit gagner 3 cl√©s pour ouvrir les portes de la Salle du Tr√©sor. \n"
        "Pour √ßa, vous allez affronter diff√©rentes √©preuves ‚Äì certaines demanderont de la force, \n"
        "d‚Äôautres de la r√©flexion, et parfois... un brin de folie. √Ä chaque d√©fi, un joueur est choisi pour y aller. \n" 
        "Et si vous r√©ussissez, hop, une cl√© pour l‚Äô√©quipe ! \n",
        '\n' +
        bold("üîë Trois cl√©s, et apr√®s ?") +'\n'
        "Une fois les trois cl√©s en poche, les portes de la Salle du Tr√©sor s‚Äôouvrent. \n"
        "Mais attention, ce n‚Äôest que le d√©but : la vraie chasse au tr√©sor ne commencera qu‚Äôune fois √† l‚Äôint√©rieur. \n" 
        "Alors, chaque cl√© compte, et chaque √©preuve est un pas de plus vers la victoire. \n",
        '\n' +
        bold("üéâ Allez, c‚Äôest parti !") +'\n'
        "Prenez une grande inspiration, serrez les coudes, et donnez tout. \n" 
        "Le Fort est rempli de surprises ‚Äì certaines sympas, d‚Äôautres... un peu moins. \n" 
        "Mais une chose est s√ªre : vous allez vivre une aventure que vous n‚Äôoublierez pas de sit√¥t ! \n"
        "Pr√™ts ? Alors, que l‚Äôaventure commence ! \n"
        )

def composer_equipe()->list[dict]:
    """
    Permet de composer une √©quipe de 1 √† 3 joueurs.
    :return: une liste de dictionnaire contenant le nom, la profession, si le joueur est le leader de l'√©quipe, et le nombre de cl√© qu'il a gagn√©
    """
    liste_joueurs = []
    n = input("Combien de joueurs se joindront √† l'aventure ? (PS: le bateau ne peut accueillir que 3 joueurs max) : ")
    while not '1' <= n <= '3':  # On ne convertit pas encore n en entier, car si l'utilisateur fait un retour √† la ligne il y a une erreur
        n = input("Le bateau doit transporter entre 1 et 3 joueurs. \n"
                  "Merci de saisir un nombre de joueur valide : ")

    leader_present = False
    for i in range(int(n)):
        print(f"Joueur n¬∞{i+1}, nous avons besoin de quelques informations sur vous.")
        nom = input("Quel est votre nom ? \n> ")
        while len(nom) == 0:
            nom = input("Vous n'avez pas de nom ? \n> ")

        profession = input("Quel est votre profession ? \n> ")
        while len(profession) == 0:
            profession = input("Vous faites forcement quelque chose dans la vie ! \n> ")

        if not leader_present :
            leader = input("Etes-vous le leader de l'√©quipe (V/F) ? \n> ")
            while leader != "V" and leader != "F":
                leader = input("Merci de saisir 'V' ou 'F' : ")
            match leader:
                case "V":
                    liste_joueurs.append({"nom":nom, "profession":profession, "est_leader":True, "cles_gagnees":0})
                    leader_present = True
                case "F":
                    liste_joueurs.append({"nom":nom, "profession":profession, "est_leader":False, "cles_gagnees":0})
                    leader_present = False
        else:   # si il y a d√©j√† un leader, on ne redemande pas
            liste_joueurs.append({"nom": nom, "profession": profession, "est_leader": False, "cles_gagnees": 0})

    if not leader_present:
        print(liste_joueurs[0]["nom"] + ", vous √™tes le leader de l'√©quipe puisque personne ne s'est port√© volontaire.")
        liste_joueurs[0]["est_leader"] = True

    return liste_joueurs

def menu_epreuves():
    """
    affiche le menu des √©preuves permettant √† l'utilisateur de choisir parmi diff√©rents types d'√©preuves disponibles
    :return: None si l'utilisateur choisi l'√©preuve 1, 2 ou 3 / si il choisi l'√©nigme du p√®re fouras, True si il r√©pond correctement et False sinon
    """
    print(
        "1. √âpreuve de Math√©matiques \n"
        "2. √âpreuve de Logique \n"
        "3. √âpreuve du hasard \n"
        "4. √ânigme du P√®re Fouras \n")
    choix = input("A quelle √©preuve voulez-vous jouer ? : ")
    while not '1' <= choix <= '4':
        choix = input("Merci de choisir un entier entre 1 et 4 : ")
    print()
    return int(choix)

def choisir_joueur(equipe)->dict:
    """
    permet √† l'utilisateur de s√©lectionner un joueur de l'√©quipe pour participer √† une √©preuve
    :param equipe: une liste de dictionnaire contenant les joueurs
    :return: un dictionnaire contenant le joueur choisi
    """
    for i in range(len(equipe)):
        if equipe[i]["est_leader"]:
            print(f"{i+1}. {equipe[i]['nom']} ({equipe[i]['profession']}) - Leader")
        else:
            print(f"{i+1}. {equipe[i]['nom']} ({equipe[i]['profession']}) - Membre")

    if len(equipe) == 1:
        print(f"L'√©quipe n'est compos√©e que de {equipe[0]['nom']}, il doit donc participer √† l'√©preuve.")
        return equipe[0]

    n = input("Entrez le num√©ro du joueur: ")
    while not '1' <= n <= str(len(equipe)):
        n = input(f"Merci de saisir un entier entre 1 et {len(equipe)} : ")
    return equipe[int(n)-1]

################
## Historique ##
################

def enregistrer_historique(nom_epreuve:str, nom_joueur:str, resultat:bool)->None:
    """
    Fonction servant √† enregistrer un historique
    :param nom_epreuve: Le nom de l'√©preuve
    :param nom_joueur: Le nom du joueur
    :param resultat: Le resultat - True si le joueur gagne, False sinon
    :return: None
    """
    enregistrement = {"nom_epreuve":nom_epreuve, "nom_joueur":nom_joueur, "resultat":resultat}
    with open("./output/historique.txt", 'a', encoding="utf-8") as historique:
        historique.write(str(enregistrement) + '\n')

def sauter_ligne_historique()->None:
    """ Saute une ligne dans l'historique pour differencier les parties """
    with open("./output/historique.txt", 'a', encoding="utf-8") as historique:
        historique.write('\n')

sauter_ligne_historique()